# 追加開発(v02)要件定義

## 背景と目的

### 現状の課題
- 現在、目標本数をテキスト入力で自由に変更できる
- 爆発前（リミット到達前）に目標本数を増やすことで、簡単に抑止力を回避できてしまう
- 飲み過ぎを防ぐという本来の目的が達成できない

### 改善の目的
- 目標本数を増やす際に心理的な抵抗を与える
- 健康的な飲酒量（2本以下）への誘導を強化する

## ユーザー情報

### 主要ユーザー
- 夫
  - ビール3本目あたりから寝落ちする可能性が増える
  - 適正飲酒量：ビール1-2本程度

## 機能要件

### 1. 目標本数の編集方法の変更
- **現状**：テキスト入力で自由に変更可能
- **変更後**：「+」「-」ボタンによる1本ずつの増減のみ

### 2. 目標本数を増やす際の確認ダイアログ
- **トリガー条件**：目標本数を3本以上に増やそうとした場合
- **表示内容**：「本当に増やしますか？」などの確認メッセージ
- **ユーザー選択肢**：
  - 「はい」：増やす → 爆発エフェクトと「飲み過ぎ注意！」メッセージを表示
  - 「いいえ」：キャンセル → 目標本数は変更されない

### 3. 目標本数を減らす際のポジティブフィードバック
- **トリガー条件**：目標本数を2本以下に減らした場合
- **表示内容**：「その調子！」「健康的な選択です！」などの褒める言葉

## UI仕様

### LimitInput コンポーネントの改修
- テキスト入力欄を削除
- 「-」ボタン、現在の目標本数表示、「+」ボタンの3要素を配置
- ボタンの無効化条件：
  - 「-」ボタン：目標本数が1本の場合は無効化
  - 「+」ボタン：特になし（上限は設けない）

### 新規ダイアログ
- **確認ダイアログ**：WarningDialog を参考に実装
- **ポジティブフィードバック**：軽量な通知またはトースト表示を検討

## 非機能要件

- 既存の localStorage による永続化を維持
- 既存の爆発エフェクトを再利用
- レスポンシブデザインを維持

## 決定事項

### 爆発エフェクトの表示タイミング
- 確認ダイアログで「はい」を選択した**後**に表示
- 順序：確認ダイアログ → ユーザーが「はい」を選択 → ダイアログを閉じる → 爆発エフェクト + 「飲み過ぎ注意！」

### ポジティブフィードバックの表示形式
- 軽量なトースト表示を採用
- ダイアログのような操作を要求せず、自動で消える
- 表示時間：2-3秒程度

### 目標本数の上限
- **上限：5本まで**
- 5本の状態で「+」ボタンを押した場合：
  - ボタンを無効化するのではなく、押せるが増えない
  - トースト表示で「飲み過ぎです」とメッセージを表示
- 「+」ボタンの無効化条件：なし（押せるが5本を超えない）

### 現在の飲酒本数が目標を超える変更をする場合の挙動
- **ケース**：目標本数を減らして、現在の飲酒本数が新しい目標を超える場合
  - 例：現在3本飲んでいる状態で、目標を4本→2本に変更しようとする
- **動作**：
  1. 確認ダイアログを表示
     - メッセージ：「既に◯本飲んでいますが、目標を△本に設定しますか？」
     - 選択肢：「はい」「いいえ」
  2. 「はい」を選択した場合：
     - 目標本数を変更
     - 穏やかな警告トーストを表示：「既に目標を超えています」
     - 爆発エフェクトは表示しない（目標を減らす良い行動を妨げないため）
  3. 「いいえ」を選択した場合：
     - 変更をキャンセル
